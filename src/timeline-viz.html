<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dataset Timeline & Impact Visualization</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #0f172a;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 10px;
        }
        
        .container {
            background: white;
            border-radius: 24px;
            padding: 20px;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
            max-width: 1400px;
            width: 100%;
        }
        
        h1 {
            text-align: center;
            color: #0f172a;
            margin-bottom: 10px;
            font-size: clamp(20px, 4vw, 36px);
            font-weight: 800;
        }
        
        .subtitle {
            text-align: center;
            color: #64748b;
            margin-bottom: 20px;
            font-size: clamp(12px, 2vw, 16px);
        }
        
        .view-description {
            text-align: center;
            color: #3b82f6;
            margin-bottom: 15px;
            font-size: clamp(11px, 1.5vw, 14px);
            font-weight: 600;
            min-height: 20px;
        }
        
        .controls {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }
        
        .control-btn {
            padding: 8px 16px;
            background: white;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            font-size: clamp(11px, 1.5vw, 14px);
            font-weight: 600;
            color: #475569;
            cursor: pointer;
            transition: all 0.3s ease;
            white-space: nowrap;
        }
        
        .control-btn:hover {
            background: #f8fafc;
            border-color: #cbd5e1;
            transform: translateY(-2px);
        }
        
        .control-btn.active {
            background: #6366f1;
            color: white;
            border-color: #6366f1;
        }
        
        #chart {
            position: relative;
            width: 100%;
            height: clamp(400px, 60vh, 700px);
            background: white;
            border-radius: 20px;
            box-shadow: 0 2px 20px rgba(0,0,0,0.08);
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
        }
        
        .bubble {
            cursor: pointer;
        }
        
        .bubble-label {
            font-size: 10px;
            font-weight: 600;
            fill: white;
            pointer-events: none;
            text-anchor: middle;
        }
        
        .axis {
            font-size: clamp(9px, 1vw, 12px);
            color: #94a3b8;
        }
        
        .axis-label {
            font-size: clamp(10px, 1.2vw, 14px);
            font-weight: 600;
            fill: #475569;
        }
        
        .grid line {
            stroke: #f1f5f9;
            stroke-opacity: 0.7;
        }
        
        .grid path {
            stroke-width: 0;
        }
        
        .tooltip {
            position: fixed;
            padding: 12px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.15);
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.3s;
            z-index: 1000;
            max-width: 280px;
            border: 1px solid #e2e8f0;
            font-size: clamp(11px, 1.3vw, 13px);
        }
        
        .tooltip h3 {
            margin: 0 0 8px 0;
            color: #0f172a;
            font-size: clamp(13px, 1.5vw, 16px);
            font-weight: 700;
        }
        
        .tooltip-row {
            display: flex;
            justify-content: space-between;
            margin: 4px 0;
            font-size: clamp(11px, 1.3vw, 13px);
        }
        
        .tooltip-label {
            color: #64748b;
        }
        
        .tooltip-value {
            color: #0f172a;
            font-weight: 600;
        }
        
        .category-badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 6px;
            font-size: clamp(10px, 1.2vw, 11px);
            font-weight: 600;
            color: white;
            margin-top: 8px;
        }
        
        .legend {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin: 20px 0 15px;
            flex-wrap: wrap;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 6px 12px;
            background: #f8fafc;
            border-radius: 8px;
        }
        
        .legend-circle {
            width: 14px;
            height: 14px;
            border-radius: 50%;
            flex-shrink: 0;
        }
        
        .legend-text {
            font-size: clamp(11px, 1.3vw, 14px);
            color: #475569;
            font-weight: 500;
        }
        
        .size-legend {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
            margin: 15px 0;
            padding: 10px;
            background: #f8fafc;
            border-radius: 12px;
            flex-wrap: wrap;
        }
        
        .size-legend-title {
            font-size: clamp(11px, 1.3vw, 14px);
            color: #475569;
            font-weight: 600;
        }
        
        .size-legend-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 2px;
        }
        
        .size-legend-circle {
            background: #cbd5e1;
            border-radius: 50%;
            opacity: 0.6;
        }
        
        .size-legend-label {
            font-size: clamp(9px, 1vw, 11px);
            color: #64748b;
        }
        
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            gap: 10px;
            margin-top: 20px;
        }
        
        .stat-card {
            text-align: center;
            padding: 15px 10px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 16px;
            color: white;
        }
        
        .stat-value {
            font-size: clamp(20px, 3vw, 32px);
            font-weight: 800;
        }
        
        .stat-label {
            font-size: clamp(10px, 1.2vw, 13px);
            opacity: 0.9;
            margin-top: 4px;
        }
        
        .year-marker {
            font-size: 11px;
            fill: #94a3b8;
            text-anchor: middle;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: scale(0); }
            to { opacity: 1; transform: scale(1); }
        }
        
        .bubble {
            animation: fadeIn 0.5s ease-out;
        }
        
        /* Mobile styles */
        @media (max-width: 768px) {
            body {
                padding: 5px;
            }
            
            .container {
                padding: 15px;
                border-radius: 16px;
            }
            
            h1 {
                margin-bottom: 5px;
            }
            
            .subtitle {
                margin-bottom: 15px;
            }
            
            .controls {
                gap: 5px;
                margin-bottom: 10px;
            }
            
            .control-btn {
                padding: 6px 12px;
                border-radius: 8px;
            }
            
            #chart {
                height: clamp(350px, 50vh, 500px);
                border-radius: 12px;
            }
            
            .legend {
                gap: 8px;
                margin: 15px 0 10px;
            }
            
            .legend-item {
                padding: 4px 8px;
                gap: 4px;
            }
            
            .legend-circle {
                width: 12px;
                height: 12px;
            }
            
            .size-legend {
                gap: 8px;
                padding: 8px;
            }
            
            .stats {
                grid-template-columns: repeat(auto-fit, minmax(80px, 1fr));
                gap: 8px;
                margin-top: 15px;
            }
            
            .stat-card {
                padding: 10px 5px;
                border-radius: 12px;
            }
            
            .tooltip {
                max-width: 240px;
                padding: 10px;
            }
        }
        
        /* Tablet styles */
        @media (min-width: 769px) and (max-width: 1024px) {
            .container {
                padding: 30px;
            }
            
            #chart {
                height: 500px;
            }
        }
        
        /* Large screen styles */
        @media (min-width: 1440px) {
            .container {
                padding: 50px;
            }
            
            #chart {
                height: 750px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ðŸ“Š Dataset Timeline & Impact Analysis</h1>
        <div class="subtitle">Explore the evolution and influence of audio datasets over time</div>
        
        <div class="controls">
            <button class="control-btn active" onclick="changeView('scatter')">Citation vs Year</button>
            <button class="control-btn" onclick="changeView('timeline')">Datasets per Year</button>
            <button class="control-btn" onclick="changeView('papers')">Research Impact</button>
        </div>
        
        <div class="view-description" id="viewDescription">
            Bubble size represents dataset size (hours of audio)
        </div>
        
        <div id="chart"></div>
        
        <div class="size-legend" id="sizeLegend">
            <span class="size-legend-title">Dataset Size (hours):</span>
            <div class="size-legend-item">
                <div class="size-legend-circle" style="width: 10px; height: 10px;"></div>
                <span class="size-legend-label">10</span>
            </div>
            <div class="size-legend-item">
                <div class="size-legend-circle" style="width: 20px; height: 20px;"></div>
                <span class="size-legend-label">1K</span>
            </div>
            <div class="size-legend-item">
                <div class="size-legend-circle" style="width: 30px; height: 30px;"></div>
                <span class="size-legend-label">5K</span>
            </div>
            <div class="size-legend-item">
                <div class="size-legend-circle" style="width: 40px; height: 40px;"></div>
                <span class="size-legend-label">7K+</span>
            </div>
        </div>
        
        <div class="legend">
            <div class="legend-item">
                <div class="legend-circle" style="background: #ef4444;"></div>
                <span class="legend-text">Speech</span>
            </div>
            <div class="legend-item">
                <div class="legend-circle" style="background: #3b82f6;"></div>
                <span class="legend-text">Environmental</span>
            </div>
            <div class="legend-item">
                <div class="legend-circle" style="background: #f59e0b;"></div>
                <span class="legend-text">Music</span>
            </div>
            <div class="legend-item">
                <div class="legend-circle" style="background: #8b5cf6;"></div>
                <span class="legend-text">Mixed/Other</span>
            </div>
        </div>
        
        <div class="stats">
            <div class="stat-card">
                <div class="stat-value">64</div>
                <div class="stat-label">Total Datasets</div>
            </div>
            <div class="stat-card">
                <div class="stat-value">52K+</div>
                <div class="stat-label">Total Citations</div>
            </div>
            <div class="stat-card">
                <div class="stat-value">32</div>
                <div class="stat-label">Years Covered</div>
            </div>
            <div class="stat-card">
                <div class="stat-value">87%</div>
                <div class="stat-label">Accessible</div>
            </div>
            <div class="stat-card">
                <div class="stat-value">5.8K</div>
                <div class="stat-label">Avg Hours</div>
            </div>
        </div>
        
        <div class="tooltip"></div>
    </div>
    
    <script>
        // Comprehensive dataset information
        const datasets = [
            {name: 'AudioSet', citations: 3950, year: 2017, category: 'Mixed/Other', papers: 591, size: 5800.0, accessible: 'yes'},
            {name: 'AudioCaps', citations: 570, year: 2019, category: 'Environmental/Natural', papers: 223, size: 135.0, accessible: 'yes'},
            {name: 'AVSpeech', citations: 959, year: 2018, category: 'Speech', papers: 36, size: 4700.0, accessible: 'yes'},
            {name: 'UrbanSound8K', citations: 1653, year: 2014, category: 'Environmental/Natural', papers: 100, size: 8.75, accessible: 'yes'},
            {name: 'ESC-50', citations: 1872, year: 2015, category: 'Environmental/Natural', papers: 302, size: 2.78, accessible: 'yes'},
            {name: 'LibriSpeech', citations: 7494, year: 2015, category: 'Speech', papers: 1922, size: 1000.0, accessible: 'yes'},
            {name: 'VGG-Sound', citations: 618, year: 2020, category: 'Environmental/Natural', papers: 179, size: 550.0, accessible: 'no'},
            {name: 'FSD50K', citations: 524, year: 2020, category: 'Environmental/Natural', papers: 139, size: 80.4, accessible: 'yes'},
            {name: 'Common Voice', citations: 1787, year: 2019, category: 'Speech', papers: 363, size: 7335.0, accessible: 'yes'},
            {name: 'GTZAN', citations: 1420, year: 2001, category: 'Music', papers: 12, size: 8.33, accessible: 'yes'},
            {name: 'VoxCeleb1', citations: 793, year: 2018, category: 'Speech', papers: 490, size: 2400.0, accessible: 'yes'},
            {name: 'ICBHI Respiratory Sound Database', citations: 313, year: 2016, category: 'Environmental/Natural', papers: 12, size: 5.5, accessible: 'yes'},
            {name: 'SHD (Spiking Heidelberg Digits)', citations: 209, year: 2022, category: 'Speech', papers: 16, size: 4.5, accessible: 'yes'},
            {name: 'Speech Commands', citations: 1882, year: 2018, category: 'Speech', papers: 336, size: 28.0, accessible: 'yes'},
            {name: 'TAU2020', citations: 132, year: 2020, category: 'Environmental/Natural', papers: 0, size: 64.0, accessible: 'yes'},
            {name: 'TUT Sound Events 2017', citations: 603, year: 2017, category: 'Environmental/Natural', papers: 7, size: 4.0, accessible: 'yes'},
            {name: 'MACS (Multi-Annotator Captioned Environmental/Naturalcapes)', citations: 40, year: 2021, category: 'Environmental/Natural', papers: 9, size: 11.0, accessible: 'yes'},
            {name: 'MagnaTagATune', citations: 236, year: 2009, category: 'Music', papers: 41, size: 136.8, accessible: 'yes'},
            {name: 'Kinetics-700', citations: 179, year: 2020, category: 'Environmental/Natural', papers: 89, size: 1805.0, accessible: 'yes'},
            {name: 'MusicNet', citations: 250, year: 2016, category: 'Music', papers: 27, size: 34.0, accessible: 'yes'},
            {name: 'EmoDB Dataset (Berlin Database of Emotional Speech)', citations: 3072, year: 2005, category: 'Speech', papers: 6, size: 0.41, accessible: 'yes'},
            {name: 'SEP-28k', citations: 118, year: 2021, category: 'Speech', papers: 18, size: 23.0, accessible: 'yes'},
            {name: 'EPIC-Environmental/Natural (EPIC-KITCHENS-100)', citations: 47, year: 2023, category: 'Environmental/Natural', papers: 148, size: 100.0, accessible: 'yes'},
            {name: 'MINDS-14', citations: 29, year: 2021, category: 'Speech', papers: 0, size: 27.0, accessible: 'yes'},
            {name: 'BGG (PUBG Gun Sound Dataset)', citations: 8, year: 2022, category: 'Environmental/Natural', papers: 1, size: 5.0, accessible: 'no'},
            {name: 'ReefSet', citations: 2, year: 2024, category: 'Environmental/Natural', papers: 1, size: 30.0, accessible: 'yes'},
            {name: 'Multimodal PISA (Multimodal Piano Skills Assessment)', citations: 35, year: 2021, category: 'Music', papers: 1, size: 10.0, accessible: 'yes'},
            {name: 'WavText5k', citations: 62, year: 2022, category: 'Environmental/Natural', papers: 0, size: 25.48, accessible: 'yes'},
            {name: 'OpenMIC-2018', citations: 111, year: 2018, category: 'Music', papers: 7, size: 55.5, accessible: 'yes'},
            {name: 'MELD', citations: 1329, year: 2018, category: 'Speech', papers: 223, size: 18.0, accessible: 'yes'},
            {name: 'MedleyDB', citations: 96, year: 2018, category: 'Music', papers: 16, size: 18.0, accessible: 'yes'},
            {name: 'FLEURS', citations: 280, year: 2022, category: 'Speech', papers: 100, size: 1400.0, accessible: 'yes'},
            {name: 'Audio Dialogues', citations: 7, year: 2024, category: 'Mixed/Other', papers: 0, size: 455.0, accessible: 'no'},
            {name: 'DEEP-VOICE: DeepFake Voice Recognition (Jordan Bird)', citations: 25, year: 2023, category: 'Speech', papers: 1, size: 1.0, accessible: 'yes'},
            {name: 'RAVDESS (Ryerson Audio-Visual Database of Emotional Speech and Song)', citations: 2154, year: 2018, category: 'Speech', papers: 25, size: 1.5, accessible: 'yes'},
            {name: 'SoundDesc', citations: 207, year: 2022, category: 'Environmental/Natural', papers: 6, size: 28.0, accessible: 'yes'},
            {name: 'Switchboard-1 Corpus', citations: 0, year: 1997, category: 'Speech', papers: 4, size: 200.0, accessible: 'no'},
            {name: 'MUSDB18', citations: 324, year: 2017, category: 'Music', papers: 75, size: 9.0, accessible: 'yes'},
            {name: 'DiCOVA', citations: 115, year: 2021, category: 'Environmental/Natural', papers: 19, size: 1.36, accessible: 'no'},
            {name: 'IEMOCAP', citations: 4124, year: 2008, category: 'Speech', papers: 558, size: 5.0, accessible: 'no'},
            {name: 'WSJ0-2mix', citations: 1812, year: 1992, category: 'Speech', papers: 114, size: 45.0, accessible: 'no'},
            {name: 'DEMAND', citations: 672, year: 2013, category: 'Environmental/Natural', papers: 0, size: 20.0, accessible: 'yes'},
            {name: 'Coswara Dataset', citations: 362, year: 2020, category: 'Environmental/Natural', papers: 0, size: 65.0, accessible: 'yes'},
            {name: 'WavCaps', citations: 156, year: 2024, category: 'Environmental/Natural', papers: 31, size: 1120.0, accessible: 'yes'},
            {name: 'TED-LIUM', citations: 372, year: 2019, category: 'Speech', papers: 43, size: 118.0, accessible: 'yes'},
            {name: 'COUGHVID', citations: 334, year: 2021, category: 'Environmental/Natural', papers: 27, size: 35.0, accessible: 'yes'},
            {name: 'Wham!', citations: 394, year: 2019, category: 'Speech', papers: 91, size: 45.0, accessible: 'yes'},
            {name: 'Cat Meow', citations: 0, year: 2021, category: 'Environmental/Natural', papers: 0, size: 0.3, accessible: 'yes'},
            {name: 'CochlScene', citations: 22, year: 2022, category: 'Environmental/Natural', papers: 4, size: 211.5, accessible: 'yes'},
            {name: 'SONYC-UST-V2', citations: 44, year: 2020, category: 'Environmental/Natural', papers: 4, size: 51.4, accessible: 'yes'},
            {name: 'Free Spoken Digit Dataset (FSDD)', citations: 50, year: 2018, category: 'Speech', papers: 3, size: 0.83, accessible: 'yes'},
            {name: 'AudioMNIST', citations: 43, year: 2018, category: 'Speech', papers: 3, size: 8.33, accessible: 'yes'},
            {name: 'AFRODIGITS', citations: 1, year: 2023, category: 'Speech', papers: 0, size: 0, accessible: 'no'},
            {name: 'SpokeN-100', citations: 1, year: 2024, category: 'Speech', papers: 0, size: 3.56, accessible: 'yes'},
            {name: 'Clotho', citations: 504, year: 2019, category: 'Environmental/Natural', papers: 179, size: 37, accessible: 'yes'},
            {name: 'MACS', citations: 0, year: 2021, category: 'Environmental/Natural', papers: 9, size: 11.88, accessible: 'yes'},
            {name: 'ISOLET', citations: 302, year: 1994, category: 'Speech', papers: 0, size: 1, accessible: 'yes'},
            {name: 'Nonspeech7k', citations: 9, year: 2023, category: 'Speech', papers: 0, size: 6.75, accessible: 'yes'},
            {name: 'aGender', citations: 121, year: 0, category: 'Speech', papers: 2, size: 47.0, accessible: 'yes'},
            {name: 'VocalSound ', citations: 51, year: 2022, category: 'Music', papers: 19, size: 23.33, accessible: 'yes'},
            {name: 'MAD', citations: 3, year: 2024, category: 'Environmental/Natural', papers: 0, size: 12.05, accessible: 'yes'},
            {name: 'Mivia Audio Events ', citations: 204, year: 2015, category: 'Environmental/Natural', papers: 0, size: 23.0, accessible: 'yes'},
            {name: 'Hey Snapdragon Keyword Dataset', citations: 53, year: 2019, category: 'Speech', papers: 0, size: 6.0, accessible: 'yes'},
            {name: 'Hey Snips', citations: 121, year: 2019, category: 'Speech', papers: 0, size: 96.0, accessible: 'yes'},
        ];
        
        // Color mapping
        const categoryColors = {
            'Speech': '#ef4444',
            'Environmental/Natural': '#3b82f6',
            'Music': '#f59e0b',
            'Mixed/Other': '#8b5cf6'
        };
        
        // Responsive dimensions
        function getResponsiveDimensions() {
            const containerWidth = document.getElementById('chart').offsetWidth;
            const containerHeight = document.getElementById('chart').offsetHeight;
            const isMobile = window.innerWidth <= 768;
            const isTablet = window.innerWidth > 768 && window.innerWidth <= 1024;
            
            let margin;
            if (isMobile) {
                margin = {top: 40, right: 30, bottom: 60, left: 50};
            } else if (isTablet) {
                margin = {top: 50, right: 40, bottom: 70, left: 60};
            } else {
                margin = {top: 60, right: 60, bottom: 80, left: 80};
            }
            
            const width = containerWidth - margin.left - margin.right;
            const height = containerHeight - margin.top - margin.bottom;
            
            return { width, height, margin, isMobile, isTablet };
        }
        
        let svg, g, xScale, yScale, sizeScale, currentView = 'scatter';
        
        function initChart() {
            // Clear existing chart
            d3.select('#chart').selectAll('*').remove();
            
            const { width, height, margin, isMobile } = getResponsiveDimensions();
            
            // Create SVG
            svg = d3.select('#chart')
                .append('svg')
                .attr('width', width + margin.left + margin.right)
                .attr('height', height + margin.top + margin.bottom)
                .style('display', 'block')
                .style('margin', '0 auto');
            
            g = svg.append('g')
                .attr('transform', `translate(${margin.left},${margin.top})`);
            
            // Create scales
            xScale = d3.scaleLinear()
                .domain([1990, 2025])
                .range([0, width]);
            
            yScale = d3.scaleLog()
                .domain([10, 10000])
                .range([height, 0]);
            
            // Responsive size scale
            const maxBubbleSize = isMobile ? 25 : 45;
            const minBubbleSize = isMobile ? 3 : 5;
            
            sizeScale = d3.scaleSqrt()
                .domain([0, d3.max(datasets, d => d.size)])
                .range([minBubbleSize, maxBubbleSize]);
            
            // Create grid
            g.append('g')
                .attr('class', 'grid')
                .attr('transform', `translate(0,${height})`)
                .call(d3.axisBottom(xScale)
                    .tickSize(-height)
                    .tickFormat('')
                );
            
            g.append('g')
                .attr('class', 'grid')
                .call(d3.axisLeft(yScale)
                    .tickSize(-width)
                    .tickFormat('')
                );
            
            // Create axes
            const xAxis = g.append('g')
                .attr('class', 'x-axis axis')
                .attr('transform', `translate(0,${height})`)
                .call(d3.axisBottom(xScale)
                    .tickFormat(d3.format('d'))
                    .tickValues(isMobile ? [1995, 2005, 2015, 2024] : [1992, 1995, 2000, 2005, 2010, 2015, 2020, 2024])
                );
            
            const yAxis = g.append('g')
                .attr('class', 'y-axis axis')
                .call(d3.axisLeft(yScale)
                    .tickFormat(d => {
                        if (d === 10) return '10';
                        if (d === 50) return '50';
                        if (d === 100) return '100';
                        if (d === 500) return '500';
                        if (d === 1000) return '1k';
                        if (d === 5000) return '5k';
                        if (d === 10000) return '10k';
                        return d;
                    })
                    .tickValues(isMobile ? [10, 100, 1000, 10000] : [10, 50, 100, 500, 1000, 5000, 10000])
                );
            
            // Add axis labels
            g.append('text')
                .attr('class', 'axis-label x-axis-label')
                .attr('text-anchor', 'middle')
                .attr('x', width / 2)
                .attr('y', height + (isMobile ? 40 : 50))
                .text('Year of Publication');
            
            g.append('text')
                .attr('class', 'axis-label y-axis-label')
                .attr('text-anchor', 'middle')
                .attr('transform', 'rotate(-90)')
                .attr('y', -(isMobile ? 35 : 50))
                .attr('x', -height / 2)
                .text('Number of Citations');
            
            // Create tooltip
            const tooltip = d3.select('.tooltip');
            
            // Create bubbles
            const bubbleGroup = g.selectAll('.bubble')
                .data(datasets)
                .enter().append('circle')
                .attr('class', 'bubble')
                .attr('cx', d => xScale(d.year))
                .attr('cy', d => yScale(Math.max(10, d.citations)))
                .attr('r', 0)
                .attr('fill', d => categoryColors[d.category])
                .attr('opacity', 0.7)
                .attr('stroke', 'white')
                .attr('stroke-width', 2);
            
            // Animate bubbles
            bubbleGroup.transition()
                .duration(800)
                .delay((d, i) => i * 10)
                .attr('r', d => sizeScale(d.size));
            
            // Add hover effects
            bubbleGroup.on('mouseover', function(event, d) {
                d3.select(this)
                    .attr('opacity', 1)
                    .attr('stroke-width', 3);
                
                tooltip.transition().duration(200).style('opacity', .95);
                tooltip.html(`
                    <h3>${d.name}</h3>
                    <div class="tooltip-row">
                        <span class="tooltip-label">Year:</span>
                        <span class="tooltip-value">${d.year}</span>
                    </div>
                    <div class="tooltip-row">
                        <span class="tooltip-label">Citations:</span>
                        <span class="tooltip-value">${d.citations.toLocaleString()}</span>
                    </div>
                    <div class="tooltip-row">
                        <span class="tooltip-label">Papers:</span>
                        <span class="tooltip-value">${d.papers}</span>
                    </div>
                    <div class="tooltip-row">
                        <span class="tooltip-label">Size:</span>
                        <span class="tooltip-value">${d.size.toLocaleString()} hours</span>
                    </div>
                    <div class="tooltip-row">
                        <span class="tooltip-label">Accessible:</span>
                        <span class="tooltip-value">${d.accessible}</span>
                    </div>
                    <div class="category-badge" style="background: ${categoryColors[d.category]}">
                        ${d.category}
                    </div>
                `)
                .style('left', (event.pageX + 15) + 'px')
                .style('top', (event.pageY - 28) + 'px');
            })
            .on('mouseout', function(event, d) {
                d3.select(this)
                    .attr('opacity', 0.7)
                    .attr('stroke-width', 2);
                tooltip.transition().duration(500).style('opacity', 0);
            })
            .on('mousemove', function(event) {
                tooltip
                    .style('left', (event.pageX + 15) + 'px')
                    .style('top', (event.pageY - 28) + 'px');
            });
        }
        
        // View change function
        function changeView(view) {
            // Update button states
            document.querySelectorAll('.control-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            currentView = view;
            
            const { width, height, isMobile } = getResponsiveDimensions();
            const viewDesc = document.getElementById('viewDescription');
            const sizeLegend = document.getElementById('sizeLegend');
            
            // Remove any existing bars
            g.selectAll('.bar').remove();
            g.selectAll('.bar-label').remove();
            
            if (view === 'timeline') {
                viewDesc.textContent = 'Number of datasets released each year';
                sizeLegend.style.display = 'none';
                
                // Count datasets per year
                const yearCounts = d3.rollup(datasets, v => v.length, d => d.year);
                const yearData = Array.from(yearCounts, ([year, count]) => ({year, count}))
                    .sort((a, b) => a.year - b.year);
                
                // Update scales for bar chart
                const xScaleBand = d3.scaleBand()
                    .domain(yearData.map(d => d.year))
                    .range([0, width])
                    .padding(0.2);
                
                const yScaleLinear = d3.scaleLinear()
                    .domain([0, d3.max(yearData, d => d.count) + 1])
                    .range([height, 0]);
                
                // Update axes
                g.select('.x-axis').transition().duration(1000)
                    .call(d3.axisBottom(xScaleBand)
                        .tickFormat(d3.format('d'))
                        .tickValues(xScaleBand.domain().filter((d, i) => isMobile ? i % 3 === 0 : i % 2 === 0)));
                
                g.select('.y-axis').transition().duration(1000)
                    .call(d3.axisLeft(yScaleLinear)
                        .tickFormat(d3.format('d'))
                        .ticks(d3.max(yearData, d => d.count)));
                
                // Hide bubbles
                g.selectAll('.bubble')
                    .transition().duration(500)
                    .attr('opacity', 0)
                    .attr('r', 0);
                
                // Create bars
                const bars = g.selectAll('.bar')
                    .data(yearData)
                    .enter().append('rect')
                    .attr('class', 'bar')
                    .attr('x', d => xScaleBand(d.year))
                    .attr('width', xScaleBand.bandwidth())
                    .attr('y', height)
                    .attr('height', 0)
                    .attr('fill', '#6366f1')
                    .attr('opacity', 0.8)
                    .style('cursor', 'pointer');
                
                // Animate bars
                bars.transition()
                    .duration(800)
                    .delay((d, i) => i * 30)
                    .attr('y', d => yScaleLinear(d.count))
                    .attr('height', d => height - yScaleLinear(d.count));
                
                // Add value labels if not mobile
                if (!isMobile) {
                    g.selectAll('.bar-label')
                        .data(yearData)
                        .enter().append('text')
                        .attr('class', 'bar-label')
                        .attr('x', d => xScaleBand(d.year) + xScaleBand.bandwidth() / 2)
                        .attr('y', d => yScaleLinear(d.count) - 5)
                        .attr('text-anchor', 'middle')
                        .style('font-size', '11px')
                        .style('font-weight', '600')
                        .style('fill', '#1a202c')
                        .style('opacity', 0)
                        .text(d => d.count)
                        .transition()
                        .duration(800)
                        .delay((d, i) => i * 30)
                        .style('opacity', 1);
                }
                
                // Hover effects for bars
                const tooltip = d3.select('.tooltip');
                bars.on('mouseover', function(event, d) {
                    d3.select(this)
                        .attr('opacity', 1)
                        .attr('fill', '#4f46e5');
                    
                    const yearDatasets = datasets.filter(ds => ds.year === d.year);
                    const datasetNames = yearDatasets.map(ds => ds.name).join('<br>');
                    
                    tooltip.transition().duration(200).style('opacity', .95);
                    tooltip.html(`
                        <h3>Year ${d.year}</h3>
                        <div class="tooltip-row">
                            <span class="tooltip-label">Datasets:</span>
                            <span class="tooltip-value">${d.count}</span>
                        </div>
                        <div style="margin-top: 10px; font-size: 11px;">
                            ${datasetNames}
                        </div>
                    `)
                    .style('left', (event.pageX + 15) + 'px')
                    .style('top', (event.pageY - 28) + 'px');
                })
                .on('mouseout', function() {
                    d3.select(this)
                        .attr('opacity', 0.8)
                        .attr('fill', '#6366f1');
                    tooltip.transition().duration(500).style('opacity', 0);
                })
                .on('mousemove', function(event) {
                    tooltip
                        .style('left', (event.pageX + 15) + 'px')
                        .style('top', (event.pageY - 28) + 'px');
                });
                
                g.select('.x-axis-label').text('Year');
                g.select('.y-axis-label').text('Number of Datasets Released');
                
            } else if (view === 'papers') {
                viewDesc.textContent = 'Gold border indicates top 5 most cited datasets';
                sizeLegend.style.display = 'none';
                
                const top5 = datasets
                    .sort((a, b) => b.citations - a.citations)
                    .slice(0, 5)
                    .map(d => d.name);
                
                const xScaleLinear = d3.scaleLinear()
                    .domain([0, d3.max(datasets, d => d.papers) + 100])
                    .range([0, width]);
                
                g.select('.x-axis').transition().duration(1000)
                    .call(d3.axisBottom(xScaleLinear)
                        .tickFormat(d3.format(','))
                        .ticks(isMobile ? 4 : 8));
                
                g.select('.y-axis').transition().duration(1000)
                    .call(d3.axisLeft(yScale)
                        .tickFormat(d => {
                            if (d === 10) return '10';
                            if (d === 50) return '50';
                            if (d === 100) return '100';
                            if (d === 500) return '500';
                            if (d === 1000) return '1k';
                            if (d === 5000) return '5k';
                            if (d === 10000) return '10k';
                            return d;
                        })
                        .tickValues(isMobile ? [10, 100, 1000, 10000] : [10, 50, 100, 500, 1000, 5000, 10000]));
                
                g.selectAll('.bubble').transition().duration(1000)
                    .attr('cx', d => xScaleLinear(d.papers))
                    .attr('cy', d => yScale(Math.max(10, d.citations)))
                    .attr('r', isMobile ? 6 : 8)
                    .attr('fill', d => categoryColors[d.category])
                    .attr('opacity', d => top5.includes(d.name) ? 1 : 0.5)
                    .attr('stroke', d => top5.includes(d.name) ? '#FFD700' : 'white')
                    .attr('stroke-width', d => top5.includes(d.name) ? 4 : 2);
                
                g.select('.x-axis-label').text('Number of Papers');
                g.select('.y-axis-label').text('Number of Citations');
                    
            } else {
                // Default scatter view
                viewDesc.textContent = 'Bubble size represents dataset size (hours of audio)';
                sizeLegend.style.display = 'flex';
                
                g.selectAll('.bubble')
                    .transition().duration(1000)
                    .attr('opacity', 0.7)
                    .attr('r', d => sizeScale(d.size));
                
                g.select('.x-axis').transition().duration(1000)
                    .call(d3.axisBottom(xScale)
                        .tickFormat(d3.format('d'))
                        .tickValues(isMobile ? [1995, 2005, 2015, 2024] : [1992, 1995, 2000, 2005, 2010, 2015, 2020, 2024]));
                        
                g.select('.y-axis').transition().duration(1000)
                    .call(d3.axisLeft(yScale)
                        .tickFormat(d => {
                            if (d === 10) return '10';
                            if (d === 50) return '50';
                            if (d === 100) return '100';
                            if (d === 500) return '500';
                            if (d === 1000) return '1k';
                            if (d === 5000) return '5k';
                            if (d === 10000) return '10k';
                            return d;
                        })
                        .tickValues(isMobile ? [10, 100, 1000, 10000] : [10, 50, 100, 500, 1000, 5000, 10000]));
                
                g.selectAll('.bubble').transition().duration(1000)
                    .attr('cx', d => xScale(d.year))
                    .attr('cy', d => yScale(Math.max(10, d.citations)))
                    .attr('r', d => sizeScale(d.size))
                    .attr('fill', d => categoryColors[d.category])
                    .attr('opacity', 0.7)
                    .attr('stroke', 'white')
                    .attr('stroke-width', 2);
                
                g.select('.x-axis-label').text('Year of Publication');
                g.select('.y-axis-label').text('Number of Citations');
            }
        }
        
        // Initialize chart on load
        initChart();
        
        // Handle resize
        let resizeTimer;
        window.addEventListener('resize', () => {
            clearTimeout(resizeTimer);
            resizeTimer = setTimeout(() => {
                initChart();
                // Restore current view after resize
                const activeBtn = document.querySelector('.control-btn.active');
                if (activeBtn && currentView !== 'scatter') {
                    const tempEvent = { target: activeBtn };
                    const originalEvent = window.event;
                    window.event = tempEvent;
                    changeView(currentView);
                    window.event = originalEvent;
                }
            }, 250);
        });
    </script>
</body>
</html>